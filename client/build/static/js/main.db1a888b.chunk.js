(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{63:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(40),c=n.n(r),s=n(68),i=n(49),l=n(24),o=n(10),u=n(1),d=function(){return Object(u.jsx)("nav",{className:"full-width bg-gray-800 py-3 px-5 lg:py-4 lg:px-6",children:Object(u.jsx)(l.b,{to:"/",className:"font-extrabold text-xl lg:text-2xl",children:"Idow"})})},j=n(25),b=n(3),x=n.n(b),p=n(6),f=n(23),g=n(69),O=function(){var e=Object(p.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/api/wars").json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){return Object(u.jsx)(j.b,{className:"w-7 h-7 animate-spin"})},v=function(e){return isNaN(e.getTime())?"":"".concat(e.getMonth()+1,"\u6708").concat(e.getDate(),"\u65e5 ").concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"))},h=function(e){var t=e.war;return Object(u.jsx)(l.b,{to:"/war/".concat(t.id),className:"p-2 lg:p-4 space-y-2 border-2 border-gray-700 bg-gray-800 rounded-sm",children:Object(u.jsxs)("div",{className:"space-y-1",children:[Object(u.jsxs)("div",{className:"flex items-baseline font-bold ",children:[Object(u.jsx)("span",{className:"mr-2",children:"vs"}),Object(u.jsx)("h2",{className:"text-2xl text-violet-500",children:t.opponent})]})," ",Object(u.jsx)("div",{children:v(new Date(t.spin_time))})]})})},y=function(e){var t=e.showLoadingSpinner,n=void 0===t||t,a=e.className,r=Object(g.a)("wars",O),c=r.data,s=r.isLoading;return Object(u.jsxs)("div",{className:"relative "+a,children:[s&&n&&Object(u.jsx)("div",{className:"absolute inset-0 flex justify-center items-center",children:Object(u.jsx)(m,{})}),!s&&(null===c||void 0===c?void 0:c.map((function(e){return Object(u.jsx)(h,{war:e},e.id)})))]})},w=function(){return Object(u.jsxs)("div",{className:"grid p-5 lg:py-12 lg:px-16 gap-y-5",children:[Object(u.jsx)("h2",{className:"text-2xl lg:text-3xl mb-2 font-bold",children:"\u5bfe\u6226\u4e00\u89a7"}),Object(u.jsxs)(l.b,{to:"/war/new",className:"flex items-center justify-center space-x-1 text-violet-200 w-min ml-auto lg:text-lg",children:[Object(u.jsx)("span",{className:"whitespace-nowrap",children:"\u65b0\u898f\u5bfe\u6226"}),Object(u.jsx)(j.c,{className:"w-5 h-5"})]}),Object(u.jsx)(y,{className:"grid lg:grid-cols-2"})]})},N=n(8),k=n(14),S=n(67),C=n(50),M=n(34),T=["color","size"],E={lg:"px-8 text-lg",md:"px-6 text-base",sm:"px-4 text-sm"},z={violet:"bg-violet-700 hover:bg-violet-600 active:bg-violet-500 text-violet-100 ring-violet-400",gray:"bg-gray-700 hover:bg-gray-600 active:bg-gray-500 text-gray-100 ring-gray-400",rose:"bg-rose-700 hover:bg-rose-600 active:bg-rose-500 text-rose-100 ring-rose-400"},H=Object(a.forwardRef)((function(e,t){var n=e.color,a=e.size,r=Object(M.a)(e,T);return Object(u.jsx)("button",Object(N.a)(Object(N.a)({},r),{},{ref:t,className:"inline-flex items-center justify-center text-center whitespace-nowrap py-3 font-semibold rounded-md focus:outline-none focus:ring-2 space-x-1 ".concat(E[a]," ").concat(z[n]),children:e.children}))})),_=["register"],I=function(e){var t=e.register,n=Object(M.a)(e,_);return Object(u.jsx)("input",Object(N.a)(Object(N.a)({className:"bg-gray-200 text-gray-900 max-w-2xl py-1 px-2 rounded-sm focus:outline-none focus:ring-2 focus:ring-violet-600"},t),n))},D=["isEditMode","label","currentValue","register"],R=function(e){var t=e.isEditMode,n=e.label,a=e.currentValue,r=e.register,c=Object(M.a)(e,D);return Object(u.jsxs)("div",{className:"flex flex-col space-y-2",children:[Object(u.jsx)("label",{className:"whitespace-nowrap",children:n}),t?Object(u.jsx)(I,Object(N.a)(Object(N.a)({},c),{},{register:r})):Object(u.jsx)("span",{className:"font-semibold text-2xl",children:a})]})},V=n(12),L=n(66),F={11:"text-rose-300",12:"text-blue-300",13:"text-cyan-300",14:"text-yellow-300"},q=function(e){var t=e.townHall,n=e.players,r=Object(a.useContext)(Q),c=r.isEditMode,s=r.roasterTags,i=r.setRoasterTags,l=function(e){return null===s||void 0===s?void 0:s.includes(e)},o=n.filter((function(e){return l(e.tag)}));if(!c&&0===o.length)return null;var d=function(e){var t=e.target.value;i((function(e){if(!e)return e;var n=Object(V.a)(e);if(l(t)){var a=n.indexOf(t);n.splice(a,1)}else n.push(t);return n}))};return Object(u.jsx)(L.a,{children:function(e){var a=e.open;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)(L.a.Button,{className:"flex w-full max-w-2xl items-center py-2 px-4 rounded-md bg-gray-700 focus:outline-none focus:ring-1 focus:ring-violet-500 overflow-hidden",children:[Object(u.jsxs)("span",{className:"text-lg font-semibold ".concat(F[t]||"text-gray-300"),children:["TH",t]}),Object(u.jsxs)("span",{className:"text-lg ml-1 letter",children:["(",o.length,")"]}),Object(u.jsx)(j.a,{className:"".concat(a?"transform rotate-180":""," w-5 h-5 ml-auto text-gray-300")})]}),Object(u.jsx)(L.a.Panel,{as:"ul",className:"my-2 px-5 divide-y-2 divide-gray-700",children:n.map((function(e){return(c||l(e.tag))&&Object(u.jsx)("li",{className:"flex justify-between items-center py-3",children:c?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("label",{children:e.name}),Object(u.jsx)("input",{className:"text-violet-600 w-5 h-5 rounded-sm focus:outline-none focus:ring-2 focus:ring-violet-600 ml-2",type:"checkbox",name:e.name,value:e.tag,checked:l(e.tag),onChange:d})]}):Object(u.jsx)("span",{children:e.name})},e.tag)}))})]})}})},B=function(e){var t=e.townHalls,n=e.roaster,r=Object(a.useContext)(Q).roasterTags;return Object(u.jsxs)("div",{className:"space-y-2",children:[Object(u.jsx)("label",{children:"\u53c2\u52a0\u30e1\u30f3\u30d0\u30fc"}),Object(u.jsxs)("div",{className:"text-violet-200 font-bold text-lg",children:["\u8a08 ",null===r||void 0===r?void 0:r.length]}),t.map((function(e){return Object(u.jsx)(q,{townHall:e,players:n[e]},e)}))]})},J=Object(a.memo)(B),P=function(e){var t=e.roaster;return Object(u.jsx)("p",{className:"bg-gray-800 px-3 py-5 rounded w-full space-y-4",children:Object.keys(t).map((function(e){return parseInt(e)})).sort((function(e,t){return t-e})).map((function(e){return Object(u.jsxs)("div",{className:"flex flex-col space-y-1",children:[Object(u.jsxs)("span",{className:"font-bold text-lg ".concat(F[e]||"text-gray-300"),children:["TH",e]}),t[e].map((function(e){var t=e.name;return Object(u.jsx)("span",{children:t})}))]})}))})},A=function(){var e=Object(p.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/api/players").json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(p.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/api/war/".concat(t)).json();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=(new Date).toISOString().split(".")[0].slice(0,-3),Q=Object(a.createContext)({isEditMode:!1,roasterTags:[],setRoasterTags:function(){}}),U=function(){var e,t,n,r,c,s=Object(o.g)().id,i=Object(o.f)(),l=function(e){return Object(g.a)(["war",e],(function(){return G(e)}))}(s),d=Object(g.a)("players",A),b=Object(C.a)(),O=b.register,h=b.handleSubmit,y=Object(a.useState)("new"===s),w=Object(k.a)(y,2),M=w[0],T=w[1],E=Object(a.useState)(!1),z=Object(k.a)(E,2),_=z[0],I=z[1],D=Object(a.useState)((null===(e=l.data)||void 0===e?void 0:e.roaster)||[]),V=Object(k.a)(D,2),L=V[0],F=V[1],q=Object(a.useRef)(null);Object(a.useEffect)((function(){var e;F((null===(e=l.data)||void 0===e?void 0:e.roaster)||[])}),[null===(t=l.data)||void 0===t?void 0:t.roaster]);var B=l.isLoading||d.isLoading,U=Object(a.useCallback)(function(){var e=Object(p.a)(x.a.mark((function e(t){var n,a,r,c,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.spin_time||(null===(n=l.data)||void 0===n?void 0:n.spin_time)){e.next=4;break}return alert("\u30de\u30c3\u30c1\u30f3\u30b0\u6642\u9593\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),e.abrupt("return");case 4:if(c=Object(N.a)(Object(N.a)({},t),{},{roaster:L,spin_time:r}),!(null===(a=l.data)||void 0===a?void 0:a.id)){e.next=10;break}return e.next=8,f.a.put("/api/war/".concat(null===(s=l.data)||void 0===s?void 0:s.id),{json:c});case 8:e.next=12;break;case 10:return e.next=12,f.a.post("/api/war",{json:c});case 12:i.go(0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[L,null===(n=l.data)||void 0===n?void 0:n.spin_time,null===(r=l.data)||void 0===r?void 0:r.id,i]),W=Object(a.useMemo)((function(){return d.data?Object.keys(d.data).map((function(e){return parseInt(e)})).sort((function(e,t){return t-e})):[]}),[d.data]),X=Object(a.useCallback)(Object(p.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.delete("/api/war/".concat(null===(t=l.data)||void 0===t?void 0:t.id));case 2:i.push("/");case 3:case"end":return e.stop()}}),e)}))),[null===(c=l.data)||void 0===c?void 0:c.id,i]);return Object(u.jsxs)("div",{className:"p-5 lg:py-12 lg:px-16 relative",children:[B&&Object(u.jsx)("div",{className:"absolute inset-0 flex justify-center items-center",children:Object(u.jsx)(m,{})}),!B&&l.isError&&"new"!==s&&Object(u.jsx)("div",{children:"\u7121\u52b9\u306aID"}),!B&&l.data&&d.data&&Object(u.jsx)(Q.Provider,{value:{isEditMode:M,roasterTags:L,setRoasterTags:F},children:Object(u.jsxs)("div",{className:"grid gap-y-10 lg:grid-cols-2 lg:gap-y-0 lg:gap-x-16",children:[Object(u.jsxs)("div",{className:"flex flex-col justify-center",children:[Object(u.jsxs)("div",{className:"flex mb-5 ml-auto space-x-3 justify-end",children:["new"!==s&&Object(u.jsxs)(H,{onClick:function(){return I(!0)},color:"rose",size:"md",children:[Object(u.jsx)("span",{className:"whitespace-nowrap",children:"\u524a\u9664"}),Object(u.jsx)(j.e,{className:"w-5 h-5"})]}),Object(u.jsxs)(H,{onClick:function(){return T((function(e){return!e}))},color:M?"violet":"gray",size:"md",children:[Object(u.jsx)("span",{className:"whitespace-nowrap",children:"\u7de8\u96c6"}),Object(u.jsx)(j.d,{className:"w-5 h-5"})]})]}),Object(u.jsxs)(S.a,{open:_,onClose:function(){return I(!1)},initialFocus:q,className:"fixed z-10 inset-0 flex items-center justify-center",children:[Object(u.jsx)(S.a.Overlay,{className:"fixed inset-0 opacity-50 bg-gray-900"}),Object(u.jsxs)("div",{className:"bg-rose-200 z-10 grid p-5 rounded-md items-center justify-center gap-y-2",children:[Object(u.jsx)(S.a.Title,{className:"flex-grow text-rose-800 text-center",children:"\u672c\u5f53\u306b\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"}),Object(u.jsxs)("div",{className:"flex space-x-3",children:[Object(u.jsx)(H,{onClick:X,color:"rose",size:"lg",children:"\u306f\u3044"}),Object(u.jsx)(H,{onClick:function(){return I(!1)},ref:q,color:"gray",size:"md",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]}),Object(u.jsxs)("form",{onSubmit:h(U),className:"flex lg:block flex-col space-y-5 lg:space-y-8",children:[Object(u.jsx)(R,{label:"\u5bfe\u6226\u76f8\u624b",type:"text",isEditMode:M,register:O("opponent"),defaultValue:l.data.opponent,currentValue:l.data.opponent,required:!0}),Object(u.jsx)(R,{label:"\u30de\u30c3\u30c1\u30f3\u30b0\u6642\u9593",type:"datetime-local",isEditMode:M,register:O("spin_time"),currentValue:v(new Date(l.data.spin_time)),min:K,required:!1}),Object(u.jsx)(J,{townHalls:W,roaster:d.data}),M&&Object(u.jsx)(H,{color:"violet",size:"lg",type:"submit",children:"\u4fdd\u5b58"})]})]}),Object(u.jsx)(P,{roaster:Object.keys(d.data).reduce((function(e,t){var n=d.data[t].filter((function(e){return L.includes(e.tag)}));return 0===n.length||(e[t]=n),e}),{})})]})})]})},W=new s.a,X=function(){return Object(u.jsx)(i.a,{client:W,children:Object(u.jsxs)(l.a,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)(o.c,{children:[Object(u.jsx)(o.a,{exact:!0,path:"/",children:Object(u.jsx)(w,{})}),Object(u.jsx)(o.a,{exact:!0,path:"/war/:id",children:Object(u.jsx)(U,{})})]})]})})};n(63);c.a.render(Object(u.jsx)(a.StrictMode,{children:Object(u.jsx)(X,{})}),document.getElementById("root"))}},[[64,1,2]]]);
//# sourceMappingURL=main.db1a888b.chunk.js.map